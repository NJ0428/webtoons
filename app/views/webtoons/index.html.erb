

<main class="max-w-7xl mx-auto px-4 py-6">

  <!-- ë©”ì¸ ë°°ë„ˆ - ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì›¹íˆ° ìºëŸ¬ì…€ -->
  <section class="mb-8">
    <div class="relative">
      <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
        <span class="text-yellow-500 mr-2">â­</span>
        ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì›¹íˆ°
      </h2>
      
      <!-- ìºëŸ¬ì…€ ì»¨í…Œì´ë„ˆ -->
      <div class="relative overflow-hidden rounded-lg">
        <div id="carousel-container" class="flex transition-transform duration-500 ease-in-out">
          <!-- ìºëŸ¬ì…€ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        
        <!-- ì´ì „/ë‹¤ìŒ ë²„íŠ¼ -->
        <button id="prev-btn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200 z-10">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <button id="next-btn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200 z-10">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
        
        <!-- ì¸ë””ì¼€ì´í„° -->
        <div id="carousel-indicators" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
          <!-- ì¸ë””ì¼€ì´í„° ì ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>
  </section>

  <!-- ìš”ì¼ë³„ ì›¹íˆ° íƒ­ -->
  <section class="mb-8">
    <div class="flex justify-center mb-6">
      <div class="flex bg-gray-100 rounded-lg p-1">
        <% 
          days = %w[ì›” í™” ìˆ˜ ëª© ê¸ˆ í†  ì¼]
          # ì‹¤ì œ ì˜¤ëŠ˜ ìš”ì¼ì˜ ì¸ë±ìŠ¤ ê³„ì‚° (0=ì›”ìš”ì¼, 6=ì¼ìš”ì¼)
          today_index = days.index(@current_day) || 6
        %>
        <% days.each_with_index do |day, index| %>
          <button onclick="switchDay('<%= day %>', this)" 
                  class="day-tab px-6 py-2 rounded-md font-medium transition-colors <%= index == today_index ? 'bg-purple-600 text-white active' : 'text-gray-600 hover:text-purple-600' %>"
                  data-day="<%= day %>">
            <%= day %>
          </button>
        <% end %>
      </div>
    </div>
  </section>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- ì›¹íˆ° ê·¸ë¦¬ë“œ -->
    <div class="lg:col-span-3">
      <div class="flex justify-between items-center mb-6">
        <h2 id="day-title" class="text-2xl font-bold text-gray-900"><%= @current_day %>ìš”ì¼ ì›¹íˆ°</h2>
        <a href="/webtoon" class="text-purple-600 hover:text-purple-700 font-medium flex items-center">
          ë”ë³´ê¸°
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      
      <div id="webtoon-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <!-- ì›¹íˆ° ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="space-y-6">
      <!-- ì¸ê¸° ê¸‰ìƒìŠ¹ -->
      <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h3 class="font-bold text-lg mb-4 flex items-center">
          <span class="text-red-500 mr-2">ğŸ”¥</span>
          ì¸ê¸° ê¸‰ìƒìŠ¹
        </h3>
        <ul class="space-y-3">
          <% @trending_comics.each_with_index do |comic, index| %>
            <li class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer transition-colors duration-200"
                onclick="location.href='/webtoon/list?titleId=<%= comic.id %>&tab=<%= comic.day_of_week %>'">
              <span class="font-bold text-lg mr-3 w-6 text-center <%= index < 3 ? 'text-red-500' : 'text-gray-500' %>">
                <%= index + 1 %>
              </span>
              <div class="w-10 h-12 rounded mr-3 flex-shrink-0 overflow-hidden">
                <img src="https://picsum.photos/40/48?random=<%= comic.id + 200 %>" 
                     alt="<%= comic.title %>" 
                     class="w-full h-full object-cover">
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 truncate"><%= comic.title %></p>
                <p class="text-xs text-gray-500"><%= comic.author %></p>
                <div class="flex items-center mt-1">
                  <span class="text-xs text-green-600 font-medium">
                    â­ <%= comic.rating %>
                  </span>
                  <span class="text-xs text-gray-400 ml-2">
                    ğŸ‘ <%= number_with_delimiter(comic.view_count) %>
                  </span>
                </div>
              </div>
              <div class="flex items-center">
                <% if index < 3 %>
                  <span class="text-red-500 text-xs">ğŸ”¥</span>
                <% elsif comic.view_count > 100000 %>
                  <span class="text-orange-500 text-xs">ğŸ“ˆ</span>
                <% end %>
              </div>
            </li>
          <% end %>
        </ul>
      </div>

      <!-- ì™„ê²° ì›¹íˆ° -->
      <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h3 class="font-bold text-lg mb-4 flex items-center">
          <span class="text-blue-500 mr-2">âœ¨</span>
          ì™„ê²° ì›¹íˆ°
        </h3>
        <div class="space-y-3">
          <% if @completed_comics&.any? %>
            <% @completed_comics.each do |comic| %>
              <div class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer transition-colors duration-200"
                   onclick="location.href='/webtoon/list?titleId=<%= comic.id %>&tab=<%= comic.day_of_week %>'">
                <div class="w-12 h-16 rounded mr-3 flex-shrink-0 overflow-hidden">
                  <img src="https://picsum.photos/48/64?random=<%= comic.id + 300 %>" 
                       alt="<%= comic.title %>" 
                       class="w-full h-full object-cover">
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900 truncate"><%= comic.title %></p>
                  <p class="text-xs text-gray-500"><%= comic.author %></p>
                  <div class="flex items-center mt-1">
                    <span class="text-xs text-blue-600 font-medium">
                      â­ <%= comic.rating %>
                    </span>
                    <span class="text-xs text-gray-400 ml-2">ì™„ê²°</span>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <% 5.times do |i| %>
              <div class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer">
                <div class="w-12 h-16 rounded mr-3 flex-shrink-0 overflow-hidden">
                  <img src="https://picsum.photos/48/64?random=<%= 100 + i %>" 
                       alt="ì™„ê²° ì›¹íˆ° <%= i + 1 %>" 
                       class="w-full h-full object-cover">
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-900">ì™„ê²° ì›¹íˆ° <%= i + 1 %></p>
                  <p class="text-xs text-gray-500">ì‘ê°€ëª…</p>
                  <div class="flex items-center mt-1">
                    <span class="text-xs text-blue-600 font-medium">â­ 4.<%= rand(1..9) %></span>
                    <span class="text-xs text-gray-400 ml-2">ì™„ê²°</span>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- ì¶”ê°€ ì„¹ì…˜ë“¤ -->
  <section class="mt-12">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">ì¥ë¥´ë³„ ì¶”ì²œ</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
      <% 
        genres = [
          { name: 'ë¡œë§¨ìŠ¤', key: 'romance', emoji: 'ğŸ’•', color: 'from-pink-400 to-red-400' },
          { name: 'ì•¡ì…˜', key: 'action', emoji: 'âš”ï¸', color: 'from-orange-400 to-red-500' },
          { name: 'íŒíƒ€ì§€', key: 'fantasy', emoji: 'ğŸ”®', color: 'from-purple-400 to-indigo-500' },
          { name: 'ì¼ìƒ', key: 'daily', emoji: 'â˜•', color: 'from-green-400 to-blue-400' },
          { name: 'ê°œê·¸', key: 'comedy', emoji: 'ğŸ˜‚', color: 'from-yellow-400 to-orange-400' },
          { name: 'ìŠ¤ë¦´ëŸ¬', key: 'thriller', emoji: 'ğŸ”ª', color: 'from-gray-600 to-black' }
        ]
      %>
      <% genres.each do |genre| %>
        <div onclick="location.href='/webtoon/genre/<%= genre[:key] %>'" 
             class="bg-white border border-gray-200 rounded-lg p-4 text-center hover:shadow-md transition-shadow cursor-pointer group">
          <div class="w-16 h-16 bg-gradient-to-br <%= genre[:color] %> rounded-full mx-auto mb-3 flex items-center justify-center text-2xl group-hover:scale-110 transition-transform duration-200">
            <%= genre[:emoji] %>
          </div>
          <p class="font-medium text-gray-900 group-hover:text-purple-600 transition-colors"><%= genre[:name] %></p>
        </div>
      <% end %>
    </div>
  </section>
</main>

<script>
// ì˜¤ëŠ˜ ìš”ì¼ ê°€ì ¸ì˜¤ê¸° (0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼)
function getTodayKoreanDay() {
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  const today = new Date().getDay();
  return days[today];
}

// í˜„ì¬ ì„ íƒëœ ìš”ì¼ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ê°’ ë˜ëŠ” ì˜¤ëŠ˜ ë‚ ì§œ)
let currentDay = '<%= @current_day %>' || getTodayKoreanDay();

// ìºëŸ¬ì…€ ê´€ë ¨ ë³€ìˆ˜
let currentSlide = 0;
let carouselComics = [];
let carouselInterval;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
document.addEventListener('DOMContentLoaded', function() {
  console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
  
  // ë¨¼ì € ì´ˆê¸° ì›¹íˆ° ëª©ë¡ì„ ì¦‰ì‹œ í‘œì‹œ
  displayInitialWebtoons();
  
  // ì˜¤ëŠ˜ ìš”ì¼ì— í•´ë‹¹í•˜ëŠ” íƒ­ì„ í™œì„±í™”
  const todayTab = document.querySelector(`[data-day="${currentDay}"]`);
  if (todayTab) {
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('.day-tab').forEach(tab => {
      tab.classList.remove('bg-purple-600', 'text-white', 'active');
      tab.classList.add('text-gray-600', 'hover:text-purple-600');
    });
    
    // ì˜¤ëŠ˜ íƒ­ í™œì„±í™”
    todayTab.classList.remove('text-gray-600', 'hover:text-purple-600');
    todayTab.classList.add('bg-purple-600', 'text-white', 'active');
  }
  
  // ì œëª© ì—…ë°ì´íŠ¸
  document.getElementById('day-title').textContent = `${currentDay}ìš”ì¼ ì›¹íˆ°`;
  
  // ìºëŸ¬ì…€ ì´ˆê¸°í™” (ì›¹íˆ° ëª©ë¡ í‘œì‹œ í›„ì—)
  setTimeout(() => {
    initializeCarousel();
  }, 100);
  
  // ì¸ê¸° ê¸‰ìƒìŠ¹ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
  addTrendingRefreshButton();
  
  // 5ë¶„ë§ˆë‹¤ ì¸ê¸° ê¸‰ìƒìŠ¹ ìë™ ì—…ë°ì´íŠ¸
  setInterval(loadTrendingWebtoons, 5 * 60 * 1000);
  
  console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
});

// ì´ˆê¸° ì›¹íˆ° ëª©ë¡ í‘œì‹œ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°)
function displayInitialWebtoons() {
  console.log('ì´ˆê¸° ì›¹íˆ° ëª©ë¡ í‘œì‹œ ì‹œì‘');
  const grid = document.getElementById('webtoon-grid');
  
  if (!grid) {
    console.error('ì›¹íˆ° ê·¸ë¦¬ë“œ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  const comics = [
    <% @comics.each do |comic| %>
      {
        id: <%= comic.id %>,
        title: '<%= j comic.title %>',
        author: '<%= j comic.author %>',
        thumbnail: '<%= comic.thumbnail_url %>',
        isNew: <%= comic.is_new %>,
        rating: <%= comic.rating %>,
        viewCount: <%= comic.view_count %>,
        genre: '<%= comic.genre %>'
      },
    <% end %>
  ];
  
  console.log('ë¡œë“œëœ ì›¹íˆ° ìˆ˜:', comics.length);
  console.log('í˜„ì¬ ìš”ì¼:', currentDay);
  
  // ì¦‰ì‹œ ì›¹íˆ° ëª©ë¡ í‘œì‹œ
  displayWebtoons(comics, currentDay);
  
  console.log('ì´ˆê¸° ì›¹íˆ° ëª©ë¡ í‘œì‹œ ì™„ë£Œ');
}

// ìš”ì¼ ì „í™˜ í•¨ìˆ˜
function switchDay(day, buttonElement) {
  // ì´ì „ í™œì„± íƒ­ ë¹„í™œì„±í™”
  document.querySelectorAll('.day-tab').forEach(tab => {
    tab.classList.remove('bg-purple-600', 'text-white', 'active');
    tab.classList.add('text-gray-600', 'hover:text-purple-600');
  });
  
  // ìƒˆ íƒ­ í™œì„±í™”
  buttonElement.classList.remove('text-gray-600', 'hover:text-purple-600');
  buttonElement.classList.add('bg-purple-600', 'text-white', 'active');
  
  // í˜„ì¬ ìš”ì¼ ì—…ë°ì´íŠ¸
  currentDay = day;
  
  // ì œëª© ì—…ë°ì´íŠ¸
  document.getElementById('day-title').textContent = `${day}ìš”ì¼ ì›¹íˆ°`;
  
  // ì›¹íˆ° ëª©ë¡ ë¡œë“œ
  loadWebtoons(day);
}

// APIì—ì„œ ì›¹íˆ° ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
async function loadWebtoons(day) {
  const grid = document.getElementById('webtoon-grid');
  
  // ë¡œë”© í‘œì‹œ
  grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">ë¡œë”© ì¤‘...</div>';
  
  try {
    const response = await fetch(`/api/webtoons/by_day/${day}`);
    const comics = await response.json();
    
    setTimeout(() => {
      displayWebtoons(comics, day);
    }, 300);
  } catch (error) {
    console.error('ì›¹íˆ° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    grid.innerHTML = '<div class="col-span-full text-center py-8 text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
  }
}

// ì›¹íˆ° ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
function displayWebtoons(comics, day) {
  const grid = document.getElementById('webtoon-grid');
  
  if (!grid) {
    console.error('ì›¹íˆ° ê·¸ë¦¬ë“œ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  if (comics.length === 0) {
    grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">í•´ë‹¹ ìš”ì¼ì— ì—°ì¬ë˜ëŠ” ì›¹íˆ°ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }
  
  console.log(`${day}ìš”ì¼ ì›¹íˆ° ${comics.length}ê°œ í‘œì‹œ ì¤‘...`);
  
  grid.innerHTML = comics.map((comic, index) => `
    <div class="group cursor-pointer">
      <a href="/webtoon/list?titleId=${comic.id}&tab=${day}" class="block">
        <div class="relative overflow-hidden rounded-lg mb-3">
          <img src="https://picsum.photos/200/300?random=${comic.id || index + 50}" 
               alt="${comic.title}" 
               class="aspect-[3/4] w-full object-cover group-hover:scale-105 transition-transform duration-200"
               loading="lazy">
          ${comic.isNew ? '<div class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">UP</div>' : ''}
          <div class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">
            â­ ${comic.rating}
          </div>
        </div>
        <h3 class="font-bold text-gray-900 text-sm mb-1 line-clamp-2 group-hover:text-purple-600 transition-colors">
          ${comic.title}
        </h3>
        <p class="text-gray-600 text-xs">${comic.author}</p>
        <p class="text-gray-500 text-xs mt-1">${comic.genre} â€¢ ì¡°íšŒìˆ˜ ${formatViewCount(comic.viewCount)}</p>
      </a>
    </div>
  `).join('');
  
  console.log(`ì›¹íˆ° ëª©ë¡ í‘œì‹œ ì™„ë£Œ: ${comics.length}ê°œ`);
}

// ì¡°íšŒìˆ˜ í¬ë§·íŒ… í•¨ìˆ˜
function formatViewCount(count) {
  if (count >= 1000000) {
    return Math.floor(count / 100000) / 10 + 'M';
  } else if (count >= 1000) {
    return Math.floor(count / 100) / 10 + 'K';
  }
  return count.toString();
}

// ì¸ê¸° ê¸‰ìƒìŠ¹ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì¶”ê°€
function addTrendingRefreshButton() {
  const trendingHeader = document.querySelector('.bg-white .font-bold');
  if (trendingHeader && trendingHeader.textContent.includes('ì¸ê¸° ê¸‰ìƒìŠ¹')) {
    const refreshButton = document.createElement('button');
    refreshButton.innerHTML = 'ğŸ”„';
    refreshButton.className = 'ml-2 text-gray-400 hover:text-gray-600 transition-colors duration-200 text-sm';
    refreshButton.title = 'ì¸ê¸° ê¸‰ìƒìŠ¹ ìƒˆë¡œê³ ì¹¨';
    refreshButton.onclick = loadTrendingWebtoons;
    trendingHeader.appendChild(refreshButton);
  }
}

// ì¸ê¸° ê¸‰ìƒìŠ¹ ì›¹íˆ° ë¡œë“œ
async function loadTrendingWebtoons() {
  try {
    const response = await fetch('/api/webtoons/trending');
    const trendingComics = await response.json();
    
    updateTrendingList(trendingComics);
  } catch (error) {
    console.error('ì¸ê¸° ê¸‰ìƒìŠ¹ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
  }
}

// ì¸ê¸° ê¸‰ìƒìŠ¹ ëª©ë¡ ì—…ë°ì´íŠ¸
function updateTrendingList(trendingComics) {
  const trendingList = document.querySelector('.bg-white ul');
  if (!trendingList) return;
  
  trendingList.innerHTML = trendingComics.map(comic => `
    <li class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer transition-colors duration-200"
        onclick="location.href='/webtoon/list?titleId=${comic.id}&tab=${comic.dayOfWeek}'">
      <span class="font-bold text-lg mr-3 w-6 text-center ${comic.isTopThree ? 'text-red-500' : 'text-gray-500'}">
        ${comic.rank}
      </span>
      <div class="w-10 h-12 rounded mr-3 flex-shrink-0 overflow-hidden">
        <img src="https://picsum.photos/40/48?random=${comic.id + 200}" 
             alt="${comic.title}" 
             class="w-full h-full object-cover">
      </div>
      <div class="flex-1 min-w-0">
        <p class="text-sm font-medium text-gray-900 truncate">${comic.title}</p>
        <p class="text-xs text-gray-500">${comic.author}</p>
        <div class="flex items-center mt-1">
          <span class="text-xs text-green-600 font-medium">
            â­ ${comic.rating}
          </span>
          <span class="text-xs text-gray-400 ml-2">
            ğŸ‘ ${formatViewCount(comic.viewCount)}
          </span>
        </div>
      </div>
      <div class="flex items-center">
        ${comic.isTopThree ? '<span class="text-red-500 text-xs">ğŸ”¥</span>' : 
          (comic.viewCount > 100000 ? '<span class="text-orange-500 text-xs">ğŸ“ˆ</span>' : '')}
      </div>
    </li>
  `).join('');
}

// ===== ìºëŸ¬ì…€ ê´€ë ¨ í•¨ìˆ˜ë“¤ =====

// ìºëŸ¬ì…€ ì´ˆê¸°í™”
async function initializeCarousel() {
  try {
    // ì¶”ì²œ ì›¹íˆ° ë°ì´í„° ë¡œë“œ (ì¸ê¸° ê¸‰ìƒìŠ¹ ì›¹íˆ° ì‚¬ìš©)
    const response = await fetch('/api/webtoons/trending');
    carouselComics = await response.json();
    
    // ìºëŸ¬ì…€ì´ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
    if (carouselComics.length === 0) {
      carouselComics = getDefaultCarouselData();
    }
    
    // ìºëŸ¬ì…€ ë Œë”ë§
    renderCarousel();
    
    // ìë™ ìŠ¬ë¼ì´ë“œ ì‹œì‘
    startAutoSlide();
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    addCarouselEventListeners();
    
  } catch (error) {
    console.error('ìºëŸ¬ì…€ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    carouselComics = getDefaultCarouselData();
    renderCarousel();
  }
}

// ê¸°ë³¸ ìºëŸ¬ì…€ ë°ì´í„°
function getDefaultCarouselData() {
  return [
    {
      id: 1,
      title: 'ì°¸êµìœ¡',
      author: 'ì±„ìš©íƒ',
      description: 'êµê¶Œì„ ë˜ì°¾ê¸° ìœ„í•œ êµì‚¬ë“¤ì˜ ì°¸êµìœ¡ ì´ì•¼ê¸°',
      rating: 9.4,
      viewCount: 2100000,
      genre: 'ì•¡ì…˜',
      isNew: true
    },
    {
      id: 2,
      title: 'ì „ì§€ì  ë…ì ì‹œì ',
      author: 'ì‹±ìˆ‘',
      description: 'ì†Œì„¤ ì† ì„¸ê³„ê°€ í˜„ì‹¤ì´ ëœ ë…ìì˜ ì´ì•¼ê¸°',
      rating: 9.6,
      viewCount: 2300000,
      genre: 'íŒíƒ€ì§€',
      isNew: false
    },
    {
      id: 3,
      title: 'ë‚˜ í˜¼ìë§Œ ë ˆë²¨ì—…',
      author: 'DUBU',
      description: 'ìµœì•½ì²´ í—Œí„°ì—ì„œ ìµœê°•ìë¡œ ì„±ì¥í•˜ëŠ” ì„±ì§„ìš°ì˜ ì´ì•¼ê¸°',
      rating: 9.7,
      viewCount: 2500000,
      genre: 'íŒíƒ€ì§€',
      isNew: false
    },
    {
      id: 4,
      title: 'ì—¬ì‹ ê°•ë¦¼',
      author: 'ì•¼ì˜¹ì´',
      description: 'ë©”ì´í¬ì—…ìœ¼ë¡œ ë³€ì‹ í•œ ì†Œë…€ì˜ ë¡œë§¨ìŠ¤ ì´ì•¼ê¸°',
      rating: 9.3,
      viewCount: 2200000,
      genre: 'ë¡œë§¨ìŠ¤',
      isNew: false
    },
    {
      id: 5,
      title: 'í™”ì‚°ê·€í™˜',
      author: 'ë¹„ê°€',
      description: 'í™”ì‚°íŒŒ ì œìê°€ ê³¼ê±°ë¡œ ëŒì•„ê°€ í¼ì¹˜ëŠ” ë¬´í˜‘ ì´ì•¼ê¸°',
      rating: 9.3,
      viewCount: 1700000,
      genre: 'ë¬´í˜‘',
      isNew: false
    }
  ];
}

// ìºëŸ¬ì…€ ë Œë”ë§
function renderCarousel() {
  const container = document.getElementById('carousel-container');
  const indicators = document.getElementById('carousel-indicators');
  
  if (!container || !indicators) return;
  
  // ìºëŸ¬ì…€ ì•„ì´í…œ ìƒì„±
  container.innerHTML = carouselComics.map((comic, index) => `
    <div class="w-full flex-shrink-0 relative">
      <div class="relative h-80 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-700 rounded-lg overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30"></div>
        <div class="absolute inset-0 flex items-center">
          <div class="flex w-full max-w-6xl mx-auto px-8">
            <!-- ì™¼ìª½: í…ìŠ¤íŠ¸ ì •ë³´ -->
            <div class="flex-1 text-white z-10">
              <div class="max-w-lg">
                ${comic.isNew ? '<span class="inline-block bg-red-500 text-white text-sm px-3 py-1 rounded-full mb-3 font-medium">NEW</span>' : ''}
                <h3 class="text-4xl font-bold mb-3">${comic.title}</h3>
                <p class="text-xl opacity-90 mb-2">ì‘ê°€: ${comic.author}</p>
                <p class="text-lg opacity-80 mb-4 leading-relaxed">${comic.description || 'í¥ë¯¸ì§„ì§„í•œ ìŠ¤í† ë¦¬ê°€ í¼ì³ì§‘ë‹ˆë‹¤.'}</p>
                <div class="flex items-center space-x-6 mb-6">
                  <div class="flex items-center">
                    <span class="text-yellow-400 mr-1">â­</span>
                    <span class="font-semibold">${comic.rating}</span>
                  </div>
                  <div class="flex items-center">
                    <span class="text-blue-300 mr-1">ğŸ‘</span>
                    <span>${formatViewCount(comic.viewCount)}</span>
                  </div>
                  <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">${comic.genre}</span>
                </div>
                <button onclick="location.href='/webtoon/list?titleId=${comic.id}'" 
                        class="bg-white text-purple-600 px-8 py-3 rounded-lg font-semibold hover:bg-opacity-90 transition-all duration-200 transform hover:scale-105">
                  ì§€ê¸ˆ ì½ê¸°
                </button>
              </div>
            </div>
            
            <!-- ì˜¤ë¥¸ìª½: ì¸ë„¤ì¼ ì´ë¯¸ì§€ -->
            <div class="flex-shrink-0 ml-8">
              <div class="w-48 h-64 rounded-lg overflow-hidden shadow-2xl transform rotate-3 hover:rotate-0 transition-transform duration-300">
                <img src="https://picsum.photos/300/400?random=${comic.id + 400}" 
                     alt="${comic.title}" 
                     class="w-full h-full object-cover">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `).join('');
  
  // ì¸ë””ì¼€ì´í„° ìƒì„±
  indicators.innerHTML = carouselComics.map((_, index) => `
    <button onclick="goToSlide(${index})" 
            class="w-3 h-3 rounded-full transition-all duration-200 ${index === currentSlide ? 'bg-white' : 'bg-white bg-opacity-50 hover:bg-opacity-75'}">
    </button>
  `).join('');
}

// ìŠ¬ë¼ì´ë“œ ì´ë™
function goToSlide(slideIndex) {
  currentSlide = slideIndex;
  updateCarouselPosition();
  updateIndicators();
  
  // ìë™ ìŠ¬ë¼ì´ë“œ ì¬ì‹œì‘
  clearInterval(carouselInterval);
  startAutoSlide();
}

// ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ
function nextSlide() {
  currentSlide = (currentSlide + 1) % carouselComics.length;
  updateCarouselPosition();
  updateIndicators();
}

// ì´ì „ ìŠ¬ë¼ì´ë“œ
function prevSlide() {
  currentSlide = (currentSlide - 1 + carouselComics.length) % carouselComics.length;
  updateCarouselPosition();
  updateIndicators();
}

// ìºëŸ¬ì…€ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
function updateCarouselPosition() {
  const container = document.getElementById('carousel-container');
  if (container) {
    container.style.transform = `translateX(-${currentSlide * 100}%)`;
  }
}

// ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
function updateIndicators() {
  const indicators = document.querySelectorAll('#carousel-indicators button');
  indicators.forEach((indicator, index) => {
    if (index === currentSlide) {
      indicator.classList.remove('bg-opacity-50', 'hover:bg-opacity-75');
      indicator.classList.add('bg-white');
    } else {
      indicator.classList.remove('bg-white');
      indicator.classList.add('bg-opacity-50', 'hover:bg-opacity-75');
    }
  });
}

// ìë™ ìŠ¬ë¼ì´ë“œ ì‹œì‘
function startAutoSlide() {
  carouselInterval = setInterval(() => {
    nextSlide();
  }, 5000); // 5ì´ˆë§ˆë‹¤ ìë™ ì „í™˜
}

// ìºëŸ¬ì…€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
function addCarouselEventListeners() {
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const carouselContainer = document.querySelector('#carousel-container').parentElement;
  
  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      prevSlide();
      clearInterval(carouselInterval);
      startAutoSlide();
    });
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      nextSlide();
      clearInterval(carouselInterval);
      startAutoSlide();
    });
  }
  
  // ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ìë™ ìŠ¬ë¼ì´ë“œ ì¼ì‹œì •ì§€
  if (carouselContainer) {
    carouselContainer.addEventListener('mouseenter', () => {
      clearInterval(carouselInterval);
    });
    
    carouselContainer.addEventListener('mouseleave', () => {
      startAutoSlide();
    });
  }
  
  // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      prevSlide();
      clearInterval(carouselInterval);
      startAutoSlide();
    } else if (e.key === 'ArrowRight') {
      nextSlide();
      clearInterval(carouselInterval);
      startAutoSlide();
    }
  });
}


</script>