<!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
<header class="bg-white border-b border-gray-200 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center h-16">
      <!-- ë¡œê³  -->
      <div class="flex items-center">
        <h1 class="text-2xl font-bold text-purple-600">ì›¹íˆ°</h1>
      </div>
      
      <!-- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ -->
      <nav class="hidden md:flex space-x-8">
        <a href="/webtoon" class="text-gray-900 hover:text-purple-600 font-medium">ì›¹íˆ°</a>
        <a href="#" class="text-gray-700 hover:text-purple-600">ë² ìŠ¤íŠ¸ë„ì „</a>
        <a href="#" class="text-gray-700 hover:text-purple-600">ë„ì „ë§Œí™”</a>
        <a href="#" class="text-gray-700 hover:text-purple-600">ì›¹ì†Œì„¤</a>
      </nav>
      
      <!-- ê²€ìƒ‰ ë° ìœ í‹¸ë¦¬í‹° -->
      <div class="flex items-center space-x-4">
        <div class="relative">
          <input type="text" placeholder="ì œëª©/ì‘ê°€ë¡œ ê²€ìƒ‰" 
                 class="w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <button class="text-gray-700 hover:text-purple-600">ë¡œê·¸ì¸</button>
      </div>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 py-6">

  <!-- ë©”ì¸ ë°°ë„ˆ -->
  <section class="mb-8">
    <div class="relative bg-gradient-to-r from-purple-500 to-violet-600 rounded-lg overflow-hidden h-80">
      <div class="absolute inset-0 bg-black bg-opacity-20"></div>
      <div class="relative z-10 flex items-center justify-center h-full">
        <div class="text-center text-white">
          <h2 class="text-4xl font-bold mb-4">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì›¹íˆ°</h2>
          <p class="text-xl opacity-90">ë§¤ì¼ ìƒˆë¡œìš´ ì¬ë¯¸ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ìš”ì¼ë³„ ì›¹íˆ° íƒ­ -->
  <section class="mb-8">
    <div class="flex justify-center mb-6">
      <div class="flex bg-gray-100 rounded-lg p-1">
        <% 
          days = %w[ì›” í™” ìˆ˜ ëª© ê¸ˆ í†  ì¼]
          today_index = 5  # í† ìš”ì¼ (0=ì›”ìš”ì¼, 5=í† ìš”ì¼)
        %>
        <% days.each_with_index do |day, index| %>
          <button onclick="switchDay('<%= day %>', this)" 
                  class="day-tab px-6 py-2 rounded-md font-medium transition-colors <%= index == today_index ? 'bg-purple-600 text-white active' : 'text-gray-600 hover:text-purple-600' %>"
                  data-day="<%= day %>">
            <%= day %>
          </button>
        <% end %>
      </div>
    </div>
  </section>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- ì›¹íˆ° ê·¸ë¦¬ë“œ -->
    <div class="lg:col-span-3">
      <div class="flex justify-between items-center mb-6">
        <h2 id="day-title" class="text-2xl font-bold text-gray-900">í† ìš”ì¼ ì›¹íˆ°</h2>
        <a href="/webtoon" class="text-purple-600 hover:text-purple-700 font-medium flex items-center">
          ë”ë³´ê¸°
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      
      <div id="webtoon-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <!-- ì›¹íˆ° ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="space-y-6">
      <!-- ì¸ê¸° ê¸‰ìƒìŠ¹ -->
      <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h3 class="font-bold text-lg mb-4 flex items-center">
          <span class="text-red-500 mr-2">ğŸ”¥</span>
          ì¸ê¸° ê¸‰ìƒìŠ¹
        </h3>
        <ul class="space-y-3">
          <% 10.times do |i| %>
            <li class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer">
              <span class="font-bold text-lg mr-3 w-6 text-center <%= i < 3 ? 'text-red-500' : 'text-gray-500' %>">
                <%= i + 1 %>
              </span>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">ì›¹íˆ° ì œëª© <%= i + 1 %></p>
                <p class="text-xs text-gray-500">ì‘ê°€ëª…</p>
              </div>
            </li>
          <% end %>
        </ul>
      </div>

      <!-- ì™„ê²° ì›¹íˆ° -->
      <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h3 class="font-bold text-lg mb-4 flex items-center">
          <span class="text-blue-500 mr-2">âœ¨</span>
          ì™„ê²° ì›¹íˆ°
        </h3>
        <div class="space-y-3">
          <% 5.times do |i| %>
            <div class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer">
              <div class="w-12 h-16 bg-gray-200 rounded mr-3 flex-shrink-0"></div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">ì™„ê²° ì›¹íˆ° <%= i + 1 %></p>
                <p class="text-xs text-gray-500">ì‘ê°€ëª…</p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- ì¶”ê°€ ì„¹ì…˜ë“¤ -->
  <section class="mt-12">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">ì¥ë¥´ë³„ ì¶”ì²œ</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
      <% %w[ë¡œë§¨ìŠ¤ ì•¡ì…˜ íŒíƒ€ì§€ ì¼ìƒ ê°œê·¸ ìŠ¤ë¦´ëŸ¬].each do |genre| %>
        <div class="bg-white border border-gray-200 rounded-lg p-4 text-center hover:shadow-md transition-shadow cursor-pointer">
          <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-3"></div>
          <p class="font-medium text-gray-900"><%= genre %></p>
        </div>
      <% end %>
    </div>
  </section>
</main>

<script>
// ì˜¤ëŠ˜ ìš”ì¼ ê°€ì ¸ì˜¤ê¸° (0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼)
function getTodayKoreanDay() {
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  const today = new Date().getDay();
  return days[today];
}

// í˜„ì¬ ì„ íƒëœ ìš”ì¼ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ê°’ ë˜ëŠ” ì˜¤ëŠ˜ ë‚ ì§œ)
let currentDay = '<%= @current_day %>' || getTodayKoreanDay();

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
document.addEventListener('DOMContentLoaded', function() {
  // ì˜¤ëŠ˜ ìš”ì¼ì— í•´ë‹¹í•˜ëŠ” íƒ­ì„ í™œì„±í™”
  const todayTab = document.querySelector(`[data-day="${currentDay}"]`);
  if (todayTab) {
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('.day-tab').forEach(tab => {
      tab.classList.remove('bg-purple-600', 'text-white', 'active');
      tab.classList.add('text-gray-600', 'hover:text-purple-600');
    });
    
    // ì˜¤ëŠ˜ íƒ­ í™œì„±í™”
    todayTab.classList.remove('text-gray-600', 'hover:text-purple-600');
    todayTab.classList.add('bg-purple-600', 'text-white', 'active');
  }
  
  // ì œëª© ì—…ë°ì´íŠ¸
  document.getElementById('day-title').textContent = `${currentDay}ìš”ì¼ ì›¹íˆ°`;
  
  // ì´ˆê¸° ì›¹íˆ° ëª©ë¡ í‘œì‹œ (ì„œë²„ì—ì„œ ì´ë¯¸ ë¡œë“œëœ ë°ì´í„° ì‚¬ìš©)
  displayInitialWebtoons();
});

// ì´ˆê¸° ì›¹íˆ° ëª©ë¡ í‘œì‹œ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°)
function displayInitialWebtoons() {
  const grid = document.getElementById('webtoon-grid');
  const comics = [
    <% @comics.each do |comic| %>
      {
        id: <%= comic.id %>,
        title: '<%= j comic.title %>',
        author: '<%= j comic.author %>',
        thumbnail: '<%= comic.thumbnail_url %>',
        isNew: <%= comic.is_new %>,
        rating: <%= comic.rating %>,
        viewCount: <%= comic.view_count %>,
        genre: '<%= comic.genre %>'
      },
    <% end %>
  ];
  
  displayWebtoons(comics, currentDay);
}

// ìš”ì¼ ì „í™˜ í•¨ìˆ˜
function switchDay(day, buttonElement) {
  // ì´ì „ í™œì„± íƒ­ ë¹„í™œì„±í™”
  document.querySelectorAll('.day-tab').forEach(tab => {
    tab.classList.remove('bg-purple-600', 'text-white', 'active');
    tab.classList.add('text-gray-600', 'hover:text-purple-600');
  });
  
  // ìƒˆ íƒ­ í™œì„±í™”
  buttonElement.classList.remove('text-gray-600', 'hover:text-purple-600');
  buttonElement.classList.add('bg-purple-600', 'text-white', 'active');
  
  // í˜„ì¬ ìš”ì¼ ì—…ë°ì´íŠ¸
  currentDay = day;
  
  // ì œëª© ì—…ë°ì´íŠ¸
  document.getElementById('day-title').textContent = `${day}ìš”ì¼ ì›¹íˆ°`;
  
  // ì›¹íˆ° ëª©ë¡ ë¡œë“œ
  loadWebtoons(day);
}

// APIì—ì„œ ì›¹íˆ° ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
async function loadWebtoons(day) {
  const grid = document.getElementById('webtoon-grid');
  
  // ë¡œë”© í‘œì‹œ
  grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">ë¡œë”© ì¤‘...</div>';
  
  try {
    const response = await fetch(`/api/webtoons/by_day/${day}`);
    const comics = await response.json();
    
    setTimeout(() => {
      displayWebtoons(comics, day);
    }, 300);
  } catch (error) {
    console.error('ì›¹íˆ° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    grid.innerHTML = '<div class="col-span-full text-center py-8 text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
  }
}

// ì›¹íˆ° ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
function displayWebtoons(comics, day) {
  const grid = document.getElementById('webtoon-grid');
  
  if (comics.length === 0) {
    grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">í•´ë‹¹ ìš”ì¼ì— ì—°ì¬ë˜ëŠ” ì›¹íˆ°ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }
  
  grid.innerHTML = comics.map(comic => `
    <div class="group cursor-pointer">
      <a href="/webtoon/list?titleId=${comic.id}&tab=${day}" class="block">
        <div class="relative overflow-hidden rounded-lg mb-3">
          ${comic.thumbnail ? 
            `<img src="${comic.thumbnail}" alt="${comic.title}" class="aspect-[3/4] w-full object-cover group-hover:scale-105 transition-transform duration-200" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
             <div class="aspect-[3/4] bg-gray-200 items-center justify-center text-gray-500 text-sm group-hover:scale-105 transition-transform duration-200" style="display:none;">
               ì›¹íˆ° ì¸ë„¤ì¼
             </div>` :
            `<div class="aspect-[3/4] bg-gray-200 flex items-center justify-center text-gray-500 text-sm group-hover:scale-105 transition-transform duration-200">
               ì›¹íˆ° ì¸ë„¤ì¼
             </div>`
          }
          ${comic.isNew ? '<div class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">UP</div>' : ''}
          <div class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">
            â­ ${comic.rating}
          </div>
        </div>
        <h3 class="font-bold text-gray-900 text-sm mb-1 line-clamp-2 group-hover:text-purple-600 transition-colors">
          ${comic.title}
        </h3>
        <p class="text-gray-600 text-xs">${comic.author}</p>
        <p class="text-gray-500 text-xs mt-1">${comic.genre} â€¢ ì¡°íšŒìˆ˜ ${formatViewCount(comic.viewCount)}</p>
      </a>
    </div>
  `).join('');
}

// ì¡°íšŒìˆ˜ í¬ë§·íŒ… í•¨ìˆ˜
function formatViewCount(count) {
  if (count >= 1000000) {
    return Math.floor(count / 100000) / 10 + 'M';
  } else if (count >= 1000) {
    return Math.floor(count / 100) / 10 + 'K';
  }
  return count.toString();
}
</script>